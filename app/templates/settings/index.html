{% extends "base.html" %}
{% block title %}Settings - VEAU{% endblock %}

{% block content %}
<div class="flex items-center gap-3 mb-6">
    <a href="{{ url_for('profiles.view', username=current_user.username) }}" class="text-gray-500">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
        </svg>
    </a>
    <h1 class="text-lg font-bold">Settings</h1>
</div>

<!-- Notifications -->
{% if pending_connections > 0 %}
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4">
    <h3 class="text-sm font-semibold text-gray-700 mb-3">Notifications</h3>
    <div class="space-y-2">
        <a href="{{ url_for('profiles.connection_requests') }}" class="flex items-center justify-between p-3 rounded-xl bg-maroon-50 hover:bg-maroon-100 transition-colors">
            <div class="flex items-center gap-3">
                <svg class="w-5 h-5 text-maroon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                </svg>
                <span class="text-sm font-medium text-gray-700">Connection requests</span>
            </div>
            <span class="bg-maroon text-white text-xs font-bold rounded-full min-w-[20px] h-5 flex items-center justify-center px-1.5">{{ pending_connections }}</span>
        </a>
    </div>
</div>
{% endif %}

<!-- Account Info -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4">
    <h3 class="text-sm font-semibold text-gray-700 mb-3">Account</h3>
    <div class="space-y-2 text-sm">
        <div class="flex justify-between">
            <span class="text-gray-500">Username</span>
            <span class="font-medium">@{{ current_user.username }}</span>
        </div>
    </div>
</div>

<!-- Preferences -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4">
    <h3 class="text-sm font-semibold text-gray-700 mb-3">Preferences</h3>
    <form method="POST" action="{{ url_for('settings.update_privacy') }}">
        {{ settings_form.hidden_tag() }}
        <div class="space-y-4">
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-700">Private Account</p>
                    <p class="text-xs text-gray-400">Only approved connections can see your posts</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    {{ settings_form.is_private(class="sr-only peer", id="privacy-toggle") }}
                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-maroon after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
            <div class="flex items-center justify-between">
                <div>
                    <p class="text-sm font-medium text-gray-700">Timer Countdown</p>
                    <p class="text-xs text-gray-400">Show 3-2-1 countdown before the timer starts</p>
                </div>
                <label class="relative inline-flex items-center cursor-pointer">
                    {{ settings_form.countdown_enabled(class="sr-only peer", id="countdown-toggle") }}
                    <div class="w-11 h-6 bg-gray-200 rounded-full peer peer-checked:bg-maroon after:content-[''] after:absolute after:top-[2px] after:start-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:after:translate-x-full"></div>
                </label>
            </div>
        </div>
        <button type="submit"
                class="w-full mt-4 bg-gray-100 text-gray-700 py-2 rounded-xl text-sm font-medium hover:bg-gray-200 transition-colors">
            Save Settings
        </button>
    </form>
</div>

<!-- Change Password -->
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-4 mb-4">
    <h3 class="text-sm font-semibold text-gray-700 mb-3">Change Password</h3>
    <form method="POST" action="{{ url_for('settings.change_password') }}" class="space-y-3">
        {{ password_form.hidden_tag() }}

        <div>
            {{ password_form.current_password(class="w-full px-4 py-2.5 rounded-xl border border-gray-200 bg-white text-sm", placeholder="Current password", autocomplete="current-password") }}
            {% for error in password_form.current_password.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
            {% endfor %}
        </div>
        <div>
            {{ password_form.new_password(class="w-full px-4 py-2.5 rounded-xl border border-gray-200 bg-white text-sm", placeholder="New password", autocomplete="new-password") }}
            {% for error in password_form.new_password.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
            {% endfor %}
        </div>
        <div>
            {{ password_form.confirm_password(class="w-full px-4 py-2.5 rounded-xl border border-gray-200 bg-white text-sm", placeholder="Confirm new password", autocomplete="new-password") }}
            {% for error in password_form.confirm_password.errors %}
            <p class="text-red-500 text-xs mt-1">{{ error }}</p>
            {% endfor %}
        </div>

        <button type="submit"
                class="w-full bg-maroon text-white py-2.5 rounded-xl text-sm font-semibold hover:bg-maroon-700 transition-colors">
            Change Password
        </button>
    </form>
</div>

<!-- Logout -->
<form method="POST" action="{{ url_for('auth.logout') }}">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    <button type="submit"
            class="w-full bg-red-50 text-red-600 py-3 rounded-xl text-sm font-medium hover:bg-red-100 transition-colors">
        Log Out
    </button>
</form>
{% endblock %}
