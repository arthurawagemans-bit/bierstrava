{% extends "base.html" %}
{% block title %}Leaderboard - VEAU{% endblock %}

{% block content %}
<h1 class="text-xl font-bold mb-4">Ranglijst</h1>

<!-- Group Tabs -->
<div class="flex gap-2 overflow-x-auto pb-2 mb-2 -mx-4 px-4 scrollbar-hide">
    <a href="{{ url_for('leaderboard.index', period=current_period) }}"
       class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors
              {{ 'bg-maroon text-white' if not current_group_id else 'bg-white text-gray-600 border border-gray-200' }}">
        Globaal
    </a>
    {% for group in groups %}
    <a href="{{ url_for('leaderboard.index', group=group.id, period=current_period) }}"
       class="flex-shrink-0 px-4 py-2 rounded-full text-sm font-medium transition-colors
              {{ 'bg-maroon text-white' if current_group_id == group.id else 'bg-white text-gray-600 border border-gray-200' }}">
        {{ group.name }}
    </a>
    {% endfor %}
</div>

<!-- Period Filter -->
<div class="flex gap-1 bg-gray-100 rounded-xl p-1 mb-4">
    {% for period, label in [('all', 'Altijd'), ('month', 'Maand'), ('week', 'Week')] %}
    <a href="{{ url_for('leaderboard.index', period=period, group=current_group_id) }}"
       class="flex-1 text-center py-2 rounded-lg text-sm font-medium transition-colors
              {{ 'bg-white text-maroon shadow-sm' if current_period == period else 'text-gray-500' }}">
        {{ label }}
    </a>
    {% endfor %}
</div>

<!-- Rankings Table -->
{% if rankings %}
<div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
    {% for r in rankings %}
    {% set rank = loop.index %}
    <div class="flex items-center gap-3 px-4 py-3 {{ 'border-b border-gray-50' if not loop.last }}
                {{ 'bg-maroon-50' if r.id == current_user.id }}">
        <!-- Rank -->
        <div class="w-8 text-center">
            {% if rank == 1 %}
            <span class="text-lg rank-1 font-bold">1</span>
            {% elif rank == 2 %}
            <span class="text-lg rank-2 font-bold">2</span>
            {% elif rank == 3 %}
            <span class="text-lg rank-3 font-bold">3</span>
            {% else %}
            <span class="text-sm text-gray-400 font-semibold">{{ rank }}</span>
            {% endif %}
        </div>

        <!-- Avatar -->
        {% if r.avatar_filename %}
        <img src="{{ upload_url(r.avatar_filename) }}"
             class="w-9 h-9 rounded-full object-cover flex-shrink-0">
        {% else %}
        <div class="w-9 h-9 rounded-full bg-maroon-100 flex items-center justify-center flex-shrink-0">
            <span class="text-maroon text-xs font-bold">{{ r.display_name[0]|upper }}</span>
        </div>
        {% endif %}

        <!-- Name -->
        <div class="flex-1 min-w-0">
            <a href="{{ url_for('profiles.view', username=r.username) }}"
               class="font-semibold text-sm truncate block {{ 'text-maroon' if r.id == current_user.id else 'text-gray-900' }}">
                {{ r.display_name }}
            </a>
            <p class="text-xs text-gray-400">{{ r.total_beers }} {{ 'bieren' if r.total_beers != 1 else 'bier' }}</p>
        </div>

        <!-- Best Time -->
        <div class="text-right">
            <span class="time-badge text-xs font-bold px-2.5 py-1 rounded-full">
                {{ r.best_time|format_time }}
            </span>
            <p class="text-[10px] text-gray-400 mt-1">gem. {{ r.avg_time|format_time if r.avg_time else '--' }}</p>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-16">
    <div class="w-16 h-16 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
        <svg class="w-8 h-8 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                  d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
        </svg>
    </div>
    <h3 class="text-gray-600 font-semibold mb-1">Nog geen ranglijst</h3>
    <p class="text-gray-400 text-sm">
        {% if current_group_id %}
        Post bieren in deze groep om hier te verschijnen.
        {% else %}
        Maak een openbaar bericht om op de globale ranglijst te verschijnen.
        {% endif %}
    </p>
</div>
{% endif %}
{% endblock %}
