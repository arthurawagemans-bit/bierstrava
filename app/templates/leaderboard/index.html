{% extends "base.html" %}
{% block title %}Eindbazen - VEAU{% endblock %}

{% block content %}
<h1 class="text-xl font-bold mb-1">VEAU Eindbazen van {{ month_name }}</h1>
<p class="text-xs text-gray-400 mb-5">De allerbeste zuipers van deze maand</p>

<!-- ‚îÄ‚îÄ Gladjakkers ‚îÄ‚îÄ -->
<div class="mb-6">
    <div class="flex items-center gap-2 mb-3">
        <span class="text-lg">‚ö°</span>
        <h2 class="text-base font-bold">Gladjakkers van {{ month_name }}</h2>
    </div>
    <p class="text-[11px] text-gray-400 mb-3">Snelste tijd per categorie (aller tijden)</p>

    {% if gladjakkers %}
    <div class="grid grid-cols-2 gap-2">
        {% for g in gladjakkers %}
        <a href="{{ url_for('profiles.view', username=g.user.username) }}"
           class="bg-white rounded-2xl shadow-sm border border-gray-100 p-3 flex flex-col items-center text-center hover:bg-gray-50 transition-colors {{ 'bg-maroon-50 border-maroon-100' if g.user.id == current_user.id }}">
            {% if g.user.avatar_filename %}
            <img src="{{ upload_url(g.user.avatar_filename) }}"
                 class="w-11 h-11 rounded-full object-cover mb-1.5 border-2 border-amber-300 shadow-sm">
            {% else %}
            <div class="w-11 h-11 rounded-full bg-maroon-100 flex items-center justify-center mb-1.5 border-2 border-amber-300 shadow-sm">
                <span class="text-maroon text-sm font-bold">{{ g.user.display_name[0]|upper }}</span>
            </div>
            {% endif %}
            <p class="text-xs font-bold text-gray-900 truncate max-w-full">{{ g.user.display_name }}</p>
            <p class="text-[10px] text-gray-400 mb-1">{{ g.category }}</p>
            <span class="time-badge text-[10px] font-bold px-2 py-0.5 rounded-full">{{ g.time|format_time }}</span>
        </a>
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 text-center">
        <p class="text-sm text-gray-400">Nog geen tijden geregistreerd</p>
    </div>
    {% endif %}
</div>

<!-- ‚îÄ‚îÄ Bier Buffels ‚îÄ‚îÄ -->
<div class="mb-6">
    <div class="flex items-center gap-2 mb-3">
        <span class="text-lg">üç∫</span>
        <h2 class="text-base font-bold">Bier Buffels van {{ month_name }}</h2>
    </div>
    <p class="text-[11px] text-gray-400 mb-3">Meeste bieren deze maand</p>

    {% if buffels %}
    <!-- Top 3 Podium -->
    {% if buffels|length >= 3 %}
    <div class="flex items-end justify-center gap-3 mb-4 px-2">
        {# 2nd place #}
        {% set r2 = buffels[1] %}
        <div class="flex flex-col items-center w-1/3">
            <a href="{{ url_for('profiles.view', username=r2.username) }}" class="flex flex-col items-center">
                <div class="relative mb-1">
                    {% if r2.avatar_filename %}
                    <img src="{{ upload_url(r2.avatar_filename) }}"
                         class="w-12 h-12 rounded-full object-cover border-2 border-gray-300 shadow-md">
                    {% else %}
                    <div class="w-12 h-12 rounded-full bg-maroon-100 flex items-center justify-center border-2 border-gray-300 shadow-md">
                        <span class="text-maroon text-sm font-bold">{{ r2.display_name[0]|upper }}</span>
                    </div>
                    {% endif %}
                    <span class="absolute -bottom-1 -right-1 bg-gray-300 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center">2</span>
                </div>
                <p class="text-[11px] font-semibold text-gray-700 truncate max-w-full">{{ r2.display_name }}</p>
                <p class="text-[10px] text-gray-400 font-medium">{{ r2.total_beers|int }} bieren</p>
            </a>
            <div class="w-full bg-gradient-to-t from-gray-200 to-gray-100 rounded-t-xl mt-2 flex items-center justify-center" style="height: 50px">
                <span class="text-xl font-bold text-gray-400">2</span>
            </div>
        </div>

        {# 1st place #}
        {% set r1 = buffels[0] %}
        <div class="flex flex-col items-center w-1/3">
            <a href="{{ url_for('profiles.view', username=r1.username) }}" class="flex flex-col items-center">
                <span class="text-lg mb-0.5">üëë</span>
                <div class="relative mb-1">
                    {% if r1.avatar_filename %}
                    <img src="{{ upload_url(r1.avatar_filename) }}"
                         class="rounded-full object-cover border-3 border-yellow-400 shadow-lg" style="width:64px;height:64px">
                    {% else %}
                    <div class="rounded-full bg-maroon-100 flex items-center justify-center border-3 border-yellow-400 shadow-lg" style="width:64px;height:64px">
                        <span class="text-maroon text-lg font-bold">{{ r1.display_name[0]|upper }}</span>
                    </div>
                    {% endif %}
                    <span class="absolute -bottom-1 -right-1 bg-yellow-400 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center">1</span>
                </div>
                <p class="text-xs font-bold text-gray-900 truncate max-w-full">{{ r1.display_name }}</p>
                <p class="text-xs text-amber-600 font-semibold">{{ r1.total_beers|int }} bieren</p>
            </a>
            <div class="w-full bg-gradient-to-t from-yellow-300 to-amber-100 rounded-t-xl mt-2 flex items-center justify-center" style="height: 70px">
                <span class="text-2xl font-bold text-amber-500">1</span>
            </div>
        </div>

        {# 3rd place #}
        {% set r3 = buffels[2] %}
        <div class="flex flex-col items-center w-1/3">
            <a href="{{ url_for('profiles.view', username=r3.username) }}" class="flex flex-col items-center">
                <div class="relative mb-1">
                    {% if r3.avatar_filename %}
                    <img src="{{ upload_url(r3.avatar_filename) }}"
                         class="w-12 h-12 rounded-full object-cover border-2 border-orange-300 shadow-md">
                    {% else %}
                    <div class="w-12 h-12 rounded-full bg-maroon-100 flex items-center justify-center border-2 border-orange-300 shadow-md">
                        <span class="text-maroon text-sm font-bold">{{ r3.display_name[0]|upper }}</span>
                    </div>
                    {% endif %}
                    <span class="absolute -bottom-1 -right-1 bg-orange-400 text-white text-[10px] font-bold w-5 h-5 rounded-full flex items-center justify-center">3</span>
                </div>
                <p class="text-[11px] font-semibold text-gray-700 truncate max-w-full">{{ r3.display_name }}</p>
                <p class="text-[10px] text-gray-400 font-medium">{{ r3.total_beers|int }} bieren</p>
            </a>
            <div class="w-full bg-gradient-to-t from-orange-200 to-orange-50 rounded-t-xl mt-2 flex items-center justify-center" style="height: 35px">
                <span class="text-lg font-bold text-orange-400">3</span>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Full ranking list -->
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 overflow-hidden">
        {% for r in buffels %}
        {% set rank = loop.index %}
        {% if buffels|length < 3 or rank > 3 %}
        <div class="flex items-center gap-3 px-4 py-3 {{ 'border-b border-gray-50' if not loop.last }}
                    {{ 'bg-maroon-50' if r.id == current_user.id }}">
            <div class="w-8 text-center">
                {% if rank <= 3 %}
                <span class="text-lg font-bold {{ 'rank-1' if rank == 1 else 'rank-2' if rank == 2 else 'rank-3' }}">{{ rank }}</span>
                {% else %}
                <span class="text-sm text-gray-400 font-semibold">{{ rank }}</span>
                {% endif %}
            </div>
            {% if r.avatar_filename %}
            <img src="{{ upload_url(r.avatar_filename) }}"
                 class="w-9 h-9 rounded-full object-cover flex-shrink-0">
            {% else %}
            <div class="w-9 h-9 rounded-full bg-maroon-100 flex items-center justify-center flex-shrink-0">
                <span class="text-maroon text-xs font-bold">{{ r.display_name[0]|upper }}</span>
            </div>
            {% endif %}
            <div class="flex-1 min-w-0">
                <a href="{{ url_for('profiles.view', username=r.username) }}"
                   class="font-semibold text-sm truncate block {{ 'text-maroon' if r.id == current_user.id else 'text-gray-900' }}">
                    {{ r.display_name }}
                </a>
                <p class="text-xs text-gray-400">{{ r.post_count }} posts</p>
            </div>
            <span class="bg-maroon-50 text-maroon text-xs font-bold px-2.5 py-1 rounded-full">{{ r.total_beers|int }}</span>
        </div>
        {% endif %}
        {% endfor %}
    </div>
    {% else %}
    <div class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6 text-center">
        <p class="text-sm text-gray-400">Nog geen bieren deze maand. Wees de eerste!</p>
    </div>
    {% endif %}
</div>
{% endblock %}
